From 727d02d3cb45b9637eebecf09337898f1f53dfd1 Mon Sep 17 00:00:00 2001
From: Hyuksoo KIM <kimhs000@naver.com>
Date: Wed, 20 Nov 2019 16:21:51 -0800
Subject: [PATCH 1/1] SD card booting setup

---
 arch/arm/dts/imx6qdl-icb-u-boot.dtsi | 4 ++--
 configs/mx6icb_defconfig             | 2 +-
 include/configs/mx6icb.h             | 4 ++--
 include/configs/mx6icb_common.h      | 3 +--
 4 files changed, 6 insertions(+), 7 deletions(-)

diff --git a/arch/arm/dts/imx6qdl-icb-u-boot.dtsi b/arch/arm/dts/imx6qdl-icb-u-boot.dtsi
index 326235aa..45f02b19 100644
--- a/arch/arm/dts/imx6qdl-icb-u-boot.dtsi
+++ b/arch/arm/dts/imx6qdl-icb-u-boot.dtsi
@@ -5,10 +5,10 @@
 
 #include "imx6qdl-u-boot.dtsi"
 
-&usdhc4 {
+&usdhc3 {
 	u-boot,dm-spl;
 };
 
-&pinctrl_usdhc4 {
+&pinctrl_usdhc3 {
 	u-boot,dm-spl;
 };
diff --git a/configs/mx6icb_defconfig b/configs/mx6icb_defconfig
index 62cd0391..3cca0d36 100644
--- a/configs/mx6icb_defconfig
+++ b/configs/mx6icb_defconfig
@@ -67,7 +67,7 @@ CONFIG_MULTI_DTB_FIT=y
 CONFIG_SPL_MULTI_DTB_FIT=y
 CONFIG_SPL_OF_LIST="imx6q-icb"
 CONFIG_SPL_MULTI_DTB_FIT_NO_COMPRESSION=y
-CONFIG_ENV_IS_IN_EMMC=y
+# CONFIG_ENV_IS_IN_EMMC is not set
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_USB_FUNCTION_FASTBOOT=y
 CONFIG_FASTBOOT_BUF_ADDR=0x12000000
diff --git a/include/configs/mx6icb.h b/include/configs/mx6icb.h
index 61ef7e38..c3b10f21 100644
--- a/include/configs/mx6icb.h
+++ b/include/configs/mx6icb.h
@@ -15,9 +15,9 @@
 #define CONFIG_MACH_TYPE	3980
 #define CONFIG_MXC_UART_BASE	UART1_BASE
 #define CONSOLE_DEV		"ttymxc0"
-#define CONFIG_MMCROOT		"/dev/mmcblk3p2"
+//#define CONFIG_MMCROOT		"/dev/mmcblk3p2"
 
-#define CONFIG_SUPPORT_EMMC_BOOT /* eMMC specific */
+//#define CONFIG_SUPPORT_EMMC_BOOT /* eMMC specific */
 
 #include "mx6icb_common.h"
 
diff --git a/include/configs/mx6icb_common.h b/include/configs/mx6icb_common.h
index 5d729cf8..86ae61c9 100644
--- a/include/configs/mx6icb_common.h
+++ b/include/configs/mx6icb_common.h
@@ -73,9 +73,8 @@
 	"dfu_alt_info=spl raw 0x400\0" \
 	"fdt_high=0xffffffff\0"	  \
 	"initrd_high=0xffffffff\0" \
-	"mmcdev=2\0" \
+	"mmcdev=" __stringify(CONFIG_SYS_MMC_ENV_DEV) "\0" \
 	"mmcpart=1\0" \
-	"mmcroot=" CONFIG_MMCROOT " rootwait rw\0" \
 	"finduuid=part uuid mmc ${mmcdev}:2 uuid\0" \
 	"update_sd_firmware=" \
 		"if test ${ip_dyn} = yes; then " \
-- 
2.17.1

